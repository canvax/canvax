"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports","./utils/index","./display/DisplayObjectContainer","./display/Stage","./renderers/autoRenderer","./geom/Matrix","mmvis"],t);else if("undefined"!=typeof exports)t(exports,require("./utils/index"),require("./display/DisplayObjectContainer"),require("./display/Stage"),require("./renderers/autoRenderer"),require("./geom/Matrix"),require("mmvis"));else{var i={};t(i,e.index,e.DisplayObjectContainer,e.Stage,e.autoRenderer,e.Matrix,e.mmvis),e.undefined=i}}(void 0,function(e,t,i,n,r,h,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=u(t),s=u(i),l=u(n),d=u(r),f=u(h);function u(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p,m,b,x=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(_,s.default),p=_,(m=[{key:"registEvent",value:function(e){return this.event=new a.event.Handler(this,e),this.event.init(),this.event}},{key:"destroy",value:function(){for(var e=0,t=this.children.length;e<t;e++){var i=this.children[e];i.destroy(),i.canvas=null,i.ctx=null,i=null,e--,t--}try{this.view.removeChild(this.stageView),this.view.removeChild(this.domView),this.el.removeChild(this.view)}catch(e){}this.el.innerHTML="",this.event=null,this._bufferStage=null}},{key:"resize",value:function(e){this.width=parseInt(e&&"width"in e||this.el.offsetWidth,10),this.height=parseInt(e&&"height"in e||this.el.offsetHeight,10),this.viewOffset=a.$.offset(this.view),this.context.$model.width=this.width,this.context.$model.height=this.height;var i=this;a._.each(this.children,function(e,t){e.context.$model.width=i.width,e.context.$model.height=i.height,function(e){e.style.width=i.width+"px",e.style.height=i.height+"px",e.setAttribute("width",i.width*o.default._devicePixelRatio),e.setAttribute("height",i.height*o.default._devicePixelRatio)}(e.canvas)}),this.stageView.style.width=this.width+"px",this.stageView.style.height=this.height+"px",this.domView.style.width=this.width+"px",this.domView.style.height=this.height+"px",this.heartBeat()}},{key:"getHoverStage",value:function(){return this._bufferStage}},{key:"_creatHoverStage",value:function(){this._bufferStage=new l.default({id:"activCanvas"+(new Date).getTime(),context:{width:this.context.$model.width,height:this.context.$model.height}}),this._bufferStage._eventEnabled=!1,this.addChild(this._bufferStage)}},{key:"updateViewOffset",value:function(){var e=(new Date).getTime();1e3<e-this.lastGetRO&&(this.viewOffset=a.$.offset(this.view),this.lastGetRO=e)}},{key:"_afterAddChild",value:function(e,t){var i;i=e.canvas?e.canvas:a.$.createCanvas(this.context.$model.width,this.context.$model.height,e.id),1==this.children.length?this.stageView.appendChild(i):1<this.children.length&&(void 0===t?this.stageView.insertBefore(i,this._bufferStage.canvas):t>=this.children.length-1?this.stageView.appendChild(i):this.stageView.insertBefore(i,this.children[t].canvas)),o.default.initElement(i),e.initStage(i,this.context.$model.width,this.context.$model.height)}},{key:"_afterDelChild",value:function(e){try{this.stageView.removeChild(e.canvas)}catch(e){}}},{key:"heartBeat",value:function(e){0<this.children.length&&this.renderer.heartBeat(e)}},{key:"toDataURL",value:function(){var e=a.$.createCanvas(this.width,this.height,"curr_base64_canvas"),t=e.getContext("2d");return a._.each(this.children,function(e){t.drawImage(e.canvas,0,0)}),e.toDataURL()}}])&&v(p.prototype,m),void(b&&v(p,b)),_);function _(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_),e.type="canvax",(t=function(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?w(e):t}(this,g(_).call(this,e)))._cid=(new Date).getTime()+"_"+Math.floor(100*Math.random()),t.el=a.$.query(e.el),t.width=parseInt("width"in e||t.el.offsetWidth,10),t.height=parseInt("height"in e||t.el.offsetHeight,10);var n=a.$.createView(t.width,t.height,t._cid);return t.view=n.view,t.stageView=n.stageView,t.domView=n.domView,t.el.innerHTML="",t.el.appendChild(t.view),t.viewOffset=a.$.offset(t.view),t.lastGetRO=0,t.webGL=e.webGL,t.renderer=(0,d.default)(w(t),i),t.event=null,t.convertStages={},t.context.$model.width=t.width,t.context.$model.height=t.height,t._bufferStage=null,t._creatHoverStage(),t.worldTransform=(new f.default).identity(),t}e.default=x});