"use strict";!function(t,e){if("function"==typeof define&&define.amd)define(["exports","mmvis","../geom/Matrix","./Point","../utils/index","../animation/AnimationFrame","../utils/observe","../const","../geom/InsideLine","../settings"],e);else if("undefined"!=typeof exports)e(exports,require("mmvis"),require("../geom/Matrix"),require("./Point"),require("../utils/index"),require("../animation/AnimationFrame"),require("../utils/observe"),require("../const"),require("../geom/InsideLine"),require("../settings"));else{var n={};e(n,t.mmvis,t.Matrix,t.Point,t.index,t.AnimationFrame,t.observe,t._const,t.InsideLine,t.settings),t.undefined=n}}(void 0,function(t,c,e,n,i,r,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=m(e),h=m(n),f=m(i),d=m(r),p=m(a),y=m(s),v=m(l);function m(t){return t&&t.__esModule?t:{default:t}}function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function b(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var k,T,O,C=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(I,c.event.Dispatcher),k=I,(T=[{key:"init",value:function(){}},{key:"clipTo",value:function(t){(this.clip=t).isClip=!0}},{key:"_createContext",value:function(t){var r=this,e=t.context||{},n={width:e.width||0,height:e.height||0,x:e.x||0,y:e.y||0,scaleX:e.scaleX||1,scaleY:e.scaleY||1,scaleOrigin:e.scaleOrigin||{x:0,y:0},rotation:e.rotation||0,rotateOrigin:e.rotateOrigin||{x:0,y:0},visible:e.visible||!0,globalAlpha:e.globalAlpha||1};return c._.extend(!0,n,t.context),r._notWatch=!1,r._noHeart=!1,n.$watch=function(t,e,n){var i=r;i.context&&("globalGalpha"==t&&(i._globalAlphaChange=!0),-1<c._.indexOf(o.TRANSFORM_PROPS,t)&&(i._updateTransform(),i._transformChange=!0),i._notWatch||(i.$watch&&(i._notWatch=!0,i.$watch(t,e,n),i._notWatch=!1),i._noHeart||i.heartBeat({convertType:"context",shape:i,name:t,value:e,preValue:n})))},(0,p.default)(n)}},{key:"track",value:function(t){-1==c._.indexOf(this._trackList,t)&&this._trackList.push(t)}},{key:"untrack",value:function(t){var e=c._.indexOf(this._trackList,t);-1<e&&this._trackList.splice(e,1)}},{key:"clone",value:function(t){var e,n={id:this.id,context:c._.clone(this.context.$model),isClone:!0};return(e="text"==this.type?new this.constructor(this.text,n):new this.constructor(n)).id=n.id,this.children&&(e.children=this.children),this.graphics&&(e.graphics=this.graphics.clone()),t||(e.id=f.default.createId(e.type)),e}},{key:"heartBeat",value:function(t){var e=this.getStage();e&&(this._heartBeatNum++,e.heartBeat&&e.heartBeat(t))}},{key:"getCurrentWidth",value:function(){return Math.abs(this.context.$model.width*this.context.$model.scaleX)}},{key:"getCurrentHeight",value:function(){return Math.abs(this.context.$model.height*this.context.$model.scaleY)}},{key:"getStage",value:function(){if(this.stage)return this.stage;var t=this;if("stage"!=t.type){for(;t.parent&&"stage"!=(t=t.parent).type;);if("stage"!==t.type)return!1}return this.stage=t}},{key:"localToGlobal",value:function(t,e){t=t||new h.default(0,0);var n=this.getConcatenatedMatrix(e);if(null==n)return(0,h.default)(0,0);var i=new u.default(1,0,0,1,t.x,t.y);return i.concat(n),new h.default(i.tx,i.ty)}},{key:"globalToLocal",value:function(t,e){if(t=t||new h.default(0,0),"stage"==this.type)return t;var n=this.getConcatenatedMatrix(e);if(null==n)return new h.default(0,0);n.invert();var i=new u.default(1,0,0,1,t.x,t.y);return i.concat(n),new h.default(i.tx,i.ty)}},{key:"localToTarget",value:function(t,e){var n=localToGlobal(t);return e.globalToLocal(n)}},{key:"getConcatenatedMatrix",value:function(t){for(var e=new u.default,n=this;null!=n;n=n.parent)if(e.concat(n._transform),!n.parent||t&&n.parent&&n.parent==t||n.parent&&"stage"==n.parent.type)return e;return e}},{key:"setEventEnable",value:function(t){return!!c._.isBoolean(t)&&(this._eventEnabled=t,!0)}},{key:"getIndex",value:function(){if(this.parent)return c._.indexOf(this.parent.children,this)}},{key:"toBack",value:function(t){if(this.parent){var e=this.getIndex(),n=0;if(c._.isNumber(t)){if(0==t)return;n=e-t}var i=this.parent.children.splice(e,1)[0];n<0&&(n=0),this.parent.addChildAt(i,n)}}},{key:"toFront",value:function(t){if(this.parent){var e=this.getIndex(),n=this.parent.children.length,i=n;if(c._.isNumber(t)){if(0==t)return;i=e+t+1}var r=this.parent.children.splice(e,1)[0];n<i&&(i=n),this.parent.addChildAt(r,i-1)}}},{key:"_updateTransform",value:function(){var t=new u.default;t.identity();var e=this.context;if(1!==e.scaleX||1!==e.scaleY){var n=new h.default(e.scaleOrigin);t.translate(-n.x,-n.y),t.scale(e.scaleX,e.scaleY),t.translate(n.x,n.y)}var i=e.rotation;if(i&&(n=new h.default(e.rotateOrigin),t.translate(-n.x,-n.y),t.rotate(i%360*Math.PI/180),t.translate(n.x,n.y)),this.xyToInt&&!this.moveing){var r=parseInt(e.x),a=parseInt(e.y);parseInt(e.lineWidth,10)%2==1&&e.strokeStyle&&(r+=.5,a+=.5)}else r=e.x,a=e.y;return 0==r&&0==a||t.translate(r,a),this._transform=t}},{key:"setWorldTransform",value:function(){var t=new u.default;return t.concat(this._transform),this.parent&&t.concat(this.parent.worldTransform),this.worldTransform=t,this.worldTransform}},{key:"getChildInPoint",value:function(t){var e=!1,n=t.x,i=t.y;if(this.worldTransform){var r=this.worldTransform.clone().invert(),a=[n*v.default.RESOLUTION,i*v.default.RESOLUTION];n=(a=r.mulVector(a))[0],i=a[1]}if(this.graphics&&(e=this.containsPoint({x:n,y:i})),"text"!=this.type)return e;var o=this.getRect();return!(!o.width||!o.height)&&(e=n>=o.x&&n<=o.x+o.width&&(0<=o.height&&i>=o.y&&i<=o.y+o.height||o.height<0&&i<=o.y&&i>=o.y+o.height))}},{key:"containsPoint",value:function(t){for(var e=!1,n=0;n<this.graphics.graphicsData.length;++n){var i=this.graphics.graphicsData[n];if(i.shape){if(i.hasFill()&&i.shape.contains(t.x,t.y)&&(e=!0))break;if(i.hasLine()&&i.shape.points&&(e=(0,y.default)(i,t.x,t.y)))break}}return e}},{key:"animate",value:function(t,e,n){if(n=n||this.context){var i=t,r=null;for(var a in i)c._.isObject(i[a])?this.animate(i[a],c._.extend({},e),n[a]):isNaN(i[a])&&""!==i[a]&&null!==i[a]?(n[a]=i[a],delete i[a]):(r=r||{})[a]=n[a];if(r){(e=e||{}).from=r,e.to=i;var o,s=this,l=function(){};e.onUpdate&&(l=e.onUpdate),e.onUpdate=function(t){if(!n&&o)return d.default.destroyTween(o),void(o=null);for(var e in t)n[e]=t[e];l.apply(s,[t])};var u=function(){};return e.onComplete&&(u=e.onComplete),e.onComplete=function(t){u.apply(s,arguments),s._removeTween(o)},e.onStop=function(){s._removeTween(o)},e.desc="tweenType:DisplayObject.animate__id:"+this.id+"__objectType:"+this.type,o=d.default.registTween(e),this._tweens.push(o),o}}}},{key:"_removeTween",value:function(t){for(var e=0;e<this._tweens.length;e++)if(t==this._tweens[e]){this._tweens.splice(e,1);break}}},{key:"removeAnimate",value:function(t){t.stop(),this._removeTween(t)}},{key:"cleanAnimates",value:function(){this._cleanAnimates()}},{key:"_cleanAnimates",value:function(){for(;this._tweens.length;)this._tweens.shift().stop()}},{key:"remove",value:function(){this.parent&&(this.parent.removeChild(this),this.parent=null)}},{key:"destroy",value:function(){this._destroy()}},{key:"_destroy",value:function(){this.remove(),this.fire("destroy"),this.context=null,delete this.context}}])&&_(k.prototype,T),void(O&&_(k,O)),I);function I(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,I),(e=function(t,e){return!e||"object"!==g(e)&&"function"!=typeof e?b(t):e}(this,x(I).call(this,t)))._transform=null,e.worldTransform=null,e._transformChange=!1,e._heartBeatNum=0,e.stage=null,e.parent=null,e.xyToInt=!("xyToInt"in t)||t.xyToInt,e.moveing=!1,e.clip=null,e.context=e._createContext(t),e.type=t.type||"DisplayObject",e.id=t.id||f.default.createId(e.type),e._trackList=[],e.init.apply(b(e),arguments),e._updateTransform(),e._tweens=[];var n=b(e);return e.on("destroy",function(){n.cleanAnimates()}),e}t.default=C});