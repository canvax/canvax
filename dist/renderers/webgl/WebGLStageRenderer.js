"use strict";!function(t,e){if("function"==typeof define&&define.amd)define(["exports","./utils/RenderTarget","./WebGLState","pixi-gl-core","../../const","../../settings","../../graphics/webgl/GraphicsRenderer"],e);else if("undefined"!=typeof exports)e(exports,require("./utils/RenderTarget"),require("./WebGLState"),require("pixi-gl-core"),require("../../const"),require("../../settings"),require("../../graphics/webgl/GraphicsRenderer"));else{var i={};e(i,t.RenderTarget,t.WebGLState,t.pixiGlCore,t._const,t.settings,t.GraphicsRenderer),t.undefined=i}}(void 0,function(t,e,i,n,r,a,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=u(e),h=u(i),l=u(n),c=u(a),d=u(s);function u(t){return t&&t.__esModule?t:{default:t}}function g(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e,i){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _,R,p,x=0,b=(_=T,(R=[{key:"_initContext",value:function(){var t=this.gl;t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext(),this.state.resetToDefault(),this.rootRenderTarget=new o.default(t,this.width,this.height,c.default.RESOLUTION,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget),this.webglGR.onContextChange()}},{key:"render",value:function(t,e){this.gl&&!this.gl.isContextLost()&&this.webglGR.render(t,e)}},{key:"resize",value:function(t,e){this.rootRenderTarget.resize(t,e),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))}},{key:"clear",value:function(t){this._activeRenderTarget.clear(t)}},{key:"bindRenderTarget",value:function(t){return t!==this._activeRenderTarget&&((this._activeRenderTarget=t).activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=t.projectionMatrix.toArray(!0))),this}},{key:"bindShader",value:function(t){return this._activeShader!==t&&((this._activeShader=t).bind(),t.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0)),this}},{key:"createVao",value:function(){return new l.default.VertexArrayObject(this.gl,this.state.attribState)}},{key:"bindVao",value:function(t){return this._activeVao===t||(t?t.bind():this._activeVao&&this._activeVao.unbind(),this._activeVao=t),this}},{key:"reset",value:function(){return this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget,this.rootRenderTarget.activate(),this.state.resetToDefault(),this}},{key:"handleContextLost",value:function(t){t.preventDefault()}},{key:"handleContextRestored",value:function(){this._initContext(),this.textureManager.removeAll()}},{key:"mapWebGLDrawModes",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};return e[r.DRAW_MODES.POINTS]=this.gl.POINTS,e[r.DRAW_MODES.LINES]=this.gl.LINES,e[r.DRAW_MODES.LINE_LOOP]=this.gl.LINE_LOOP,e[r.DRAW_MODES.LINE_STRIP]=this.gl.LINE_STRIP,e[r.DRAW_MODES.TRIANGLES]=this.gl.TRIANGLES,e[r.DRAW_MODES.TRIANGLE_STRIP]=this.gl.TRIANGLE_STRIP,e[r.DRAW_MODES.TRIANGLE_FAN]=this.gl.TRIANGLE_FAN,e}},{key:"destroy",value:function(t){this.destroyPlugins(),this.canvas.removeEventListener("webglcontextlost",this.handleContextLost),this.canvas.removeEventListener("webglcontextrestored",this.handleContextRestored),v(f(T.prototype),"destroy",this).call(this,t),this.uid=0,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null}}])&&g(_.prototype,R),void(p&&g(_,p)),T);function T(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,T),this.type=r.RENDERER_TYPE.WEBGL,this.width=e.width,this.height=e.height,this.canvas=t.canvas,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.canvas.addEventListener("webglcontextlost",this.handleContextLost,!1),this.canvas.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._backgroundColorRgba=[0,0,0,0],this._contextOptions={alpha:i.transparent,antialias:i.antialias,premultipliedAlpha:i.transparent&&"notMultiplied"!==i.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer},this.gl=i.context||l.default.createContext(this.canvas,this._contextOptions),this.CONTEXT_UID=x++,this.state=new h.default(this.gl),this._activeShader=null,this._activeVao=null,this._activeRenderTarget=null,this.drawModes=this.mapWebGLDrawModes(),this.webglGR=new d.default(this),this._initContext()}t.default=b});