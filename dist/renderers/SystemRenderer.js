"use strict";!function(e,t){if("function"==typeof define&&define.amd)define(["exports","../const","../settings","../animation/AnimationFrame","../utils/index","mmvis"],t);else if("undefined"!=typeof exports)t(exports,require("../const"),require("../settings"),require("../animation/AnimationFrame"),require("../utils/index"),require("mmvis"));else{var a={};t(a,e._const,e.settings,e.AnimationFrame,e.index,e.mmvis),e.undefined=a}}(void 0,function(e,i,t,a,n,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=c(t),o=c(a),p=c(n);function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v,d,l,f=(v=h,(d=[{key:"startEnter",value:function(){var e=this;e.requestAid||(e.requestAid=o.default.registFrame({id:"enterFrame",task:function(){e.enterFrame.apply(e)}}))}},{key:"enterFrame",value:function(){var e=this;e.requestAid=null,p.default.now=(new Date).getTime(),e._heartBeat&&(this.app.children.length&&e.render(this.app),e._heartBeat=!1,e._preRenderTime=(new Date).getTime())}},{key:"_convertCanvax",value:function(t){r._.each(this.app.children,function(e){e.context[t.name]=t.value})}},{key:"heartBeat",value:function(e){var a=this;if(e){if("context"==e.convertType){var t=e.stage,n=e.shape;if(e.name,e.value,e.preValue,"canvax"==n.type)a._convertCanvax(e);else if(a.app.convertStages[t.id]||(a.app.convertStages[t.id]={stage:t,convertShapes:{}}),n){if(a.app.convertStages[t.id].convertShapes[n.id])return;a.app.convertStages[t.id].convertShapes[n.id]={shape:n,convertType:e.convertType}}}if("children"==e.convertType){var i=e.target;!(t=e.src.getStage())&&"stage"!=i.type||(t=t||i,a.app.convertStages[t.id]||(a.app.convertStages[t.id]={stage:t,convertShapes:{}}))}e.convertType||(t=e.stage,a.app.convertStages[t.id]||(a.app.convertStages[t.id]={stage:t,convertShapes:{}}))}else r._.each(a.app.children,function(e,t){a.app.convertStages[e.id]={stage:e,convertShapes:{}}});a._heartBeat?a._heartBeat=!0:(a._heartBeat=!0,a.startEnter())}}])&&u(v.prototype,d),void(l&&u(v,l)),h);function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:i.RENDERER_TYPE.UNKNOWN,t=1<arguments.length?arguments[1]:void 0,a=2<arguments.length?arguments[2]:void 0;if(!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),this.type=e,this.app=t,a)for(var n in s.default.RENDER_OPTIONS)void 0===a[n]&&(a[n]=s.default.RENDER_OPTIONS[n]);else a=s.default.RENDER_OPTIONS;this.options=a,this.requestAid=null,this._heartBeat=!1,this._preRenderTime=0}e.default=f});