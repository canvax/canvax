define("display/DisplayObject",["mmvis","../geom/Matrix","./Point","../utils/index","../animation/AnimationFrame","../utils/observe","../const","../geom/InsideLine","../settings"],function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var a=t("mmvis"),o=t("../geom/Matrix"),s=t("./Point"),l=t("../utils/index"),h=t("../animation/AnimationFrame"),c=t("../utils/observe"),p=t("../const"),u=t("../geom/InsideLine"),f=t("../settings"),d=function(t){function e(e){var n=t.call(this,e)||this;n._transform=null,n.worldTransform=null,n._transformChange=!1,n._heartBeatNum=0,n.stage=null,n.parent=null,n.xyToInt=!("xyToInt"in e)||e.xyToInt,n.moveing=!1,n.clip=null,n.context=n._createContext(e),n.type=e.type||"DisplayObject",n.id=e.id||l.default.createId(n.type),n._trackList=[],n.init.apply(n,arguments),n._updateTransform(),n._tweens=[];var i=n;return n.on("destory",function(){i.cleanAnimates()}),n}return r(e,t),e.prototype.init=function(){},e.prototype.clipTo=function(t){this.clip=t,t.isClip=!0},e.prototype._createContext=function(t){var e=this,n=t.context||{},i={width:n.width||0,height:n.height||0,x:n.x||0,y:n.y||0,scaleX:n.scaleX||1,scaleY:n.scaleY||1,scaleOrigin:n.scaleOrigin||{x:0,y:0},rotation:n.rotation||0,rotateOrigin:n.rotateOrigin||{x:0,y:0},visible:n.visible||!0,globalAlpha:n.globalAlpha||1};return a._.extend(!0,i,t.context),e._notWatch=!1,e._noHeart=!1,i.$watch=function(t,n,i){var r=e;r.context&&("globalGalpha"==t&&(r._globalAlphaChange=!0),a._.indexOf(p.TRANSFORM_PROPS,t)>-1&&(r._updateTransform(),r._transformChange=!0),r._notWatch||(r.$watch&&(r._notWatch=!0,r.$watch(t,n,i),r._notWatch=!1),r._noHeart||r.heartBeat({convertType:"context",shape:r,name:t,value:n,preValue:i})))},c.default(i)},e.prototype.track=function(t){-1==a._.indexOf(this._trackList,t)&&this._trackList.push(t)},e.prototype.untrack=function(t){var e=a._.indexOf(this._trackList,t);e>-1&&this._trackList.splice(e,1)},e.prototype.clone=function(t){var e,n={id:this.id,context:a._.clone(this.context.$model),isClone:!0};return(e="text"==this.type?new this.constructor(this.text,n):new this.constructor(n)).id=n.id,this.children&&(e.children=this.children),this.graphics&&(e.graphics=this.graphics.clone()),t||(e.id=l.default.createId(e.type)),e},e.prototype.heartBeat=function(t){var e=this.getStage();e&&(this._heartBeatNum++,e.heartBeat&&e.heartBeat(t))},e.prototype.getCurrentWidth=function(){return Math.abs(this.context.$model.width*this.context.$model.scaleX)},e.prototype.getCurrentHeight=function(){return Math.abs(this.context.$model.height*this.context.$model.scaleY)},e.prototype.getStage=function(){if(this.stage)return this.stage;var t=this;if("stage"!=t.type){for(;t.parent&&"stage"!=(t=t.parent).type;);if("stage"!==t.type)return!1}return this.stage=t,t},e.prototype.localToGlobal=function(t,e){!t&&(t=new s.default(0,0));var n=this.getConcatenatedMatrix(e);if(null==n)return s.default(0,0);var i=new o.default(1,0,0,1,t.x,t.y);return i.concat(n),new s.default(i.tx,i.ty)},e.prototype.globalToLocal=function(t,e){if(!t&&(t=new s.default(0,0)),"stage"==this.type)return t;var n=this.getConcatenatedMatrix(e);if(null==n)return new s.default(0,0);n.invert();var i=new o.default(1,0,0,1,t.x,t.y);return i.concat(n),new s.default(i.tx,i.ty)},e.prototype.localToTarget=function(t,e){var n=localToGlobal(t);return e.globalToLocal(n)},e.prototype.getConcatenatedMatrix=function(t){for(var e=new o.default,n=this;null!=n;n=n.parent)if(e.concat(n._transform),!n.parent||t&&n.parent&&n.parent==t||n.parent&&"stage"==n.parent.type)return e;return e},e.prototype.setEventEnable=function(t){return!!a._.isBoolean(t)&&(this._eventEnabled=t,!0)},e.prototype.getIndex=function(){if(this.parent)return a._.indexOf(this.parent.children,this)},e.prototype.toBack=function(t){if(this.parent){var e=this.getIndex(),n=0;if(a._.isNumber(t)){if(0==t)return;n=e-t}var i=this.parent.children.splice(e,1)[0];n<0&&(n=0),this.parent.addChildAt(i,n)}},e.prototype.toFront=function(t){if(this.parent){var e=this.getIndex(),n=this.parent.children.length,i=n;if(a._.isNumber(t)){if(0==t)return;i=e+t+1}var r=this.parent.children.splice(e,1)[0];i>n&&(i=n),this.parent.addChildAt(r,i-1)}},e.prototype._updateTransform=function(){var t=new o.default;t.identity();var e=this.context;1===e.scaleX&&1===e.scaleY||(((n=new s.default(e.scaleOrigin)).x||n.y)&&t.translate(-n.x,-n.y),t.scale(e.scaleX,e.scaleY),(n.x||n.y)&&t.translate(n.x,n.y));var n,i=e.rotation;i&&(((n=new s.default(e.rotateOrigin)).x||n.y)&&t.translate(-n.x,-n.y),t.rotate(i%360*Math.PI/180),(n.x||n.y)&&t.translate(n.x,n.y));if(this.xyToInt&&!this.moveing){var r=parseInt(e.x),a=parseInt(e.y);parseInt(e.lineWidth,10)%2==1&&e.strokeStyle&&(r+=.5,a+=.5)}else r=e.x,a=e.y;return 0==r&&0==a||t.translate(r,a),this._transform=t,t},e.prototype.setWorldTransform=function(){var t=new o.default;return t.concat(this._transform),this.parent&&t.concat(this.parent.worldTransform),this.worldTransform=t,this.worldTransform},e.prototype.getChildInPoint=function(t){var e=!1,n=t.x,i=t.y;if(this.worldTransform){var r=this.worldTransform.clone().invert(),a=[n*f.default.RESOLUTION,i*f.default.RESOLUTION];n=(a=r.mulVector(a))[0],i=a[1]}if(this.graphics&&(e=this.containsPoint({x:n,y:i})),"text"==this.type){var o=this.getRect();return!(!o.width||!o.height)&&(e=n>=o.x&&n<=o.x+o.width&&(o.height>=0&&i>=o.y&&i<=o.y+o.height||o.height<0&&i<=o.y&&i>=o.y+o.height))}return e},e.prototype.containsPoint=function(t){for(var e=!1,n=0;n<this.graphics.graphicsData.length;++n){var i=this.graphics.graphicsData[n];if(i.shape){if(i.hasFill()&&i.shape.contains(t.x,t.y)&&(e=!0))break;if(i.hasLine()&&i.shape.points&&(e=u.default(i,t.x,t.y)))break}}return e},e.prototype.animate=function(t,e,n){if(n||(n=this.context),n){var i=t,r=null;for(var o in i)a._.isObject(i[o])?this.animate(i[o],a._.extend({},e),n[o]):isNaN(i[o])&&""!==i[o]&&null!==i[o]?(n[o]=i[o],delete i[o]):(r||(r={}),r[o]=n[o]);if(r){!e&&(e={}),e.from=r,e.to=i;var s,l=this,c=function(){};e.onUpdate&&(c=e.onUpdate),e.onUpdate=function(t){if(!n&&s)return h.default.destroyTween(s),void(s=null);for(var e in t)n[e]=t[e];c.apply(l,[t])};var p=function(){};return e.onComplete&&(p=e.onComplete),e.onComplete=function(t){p.apply(l,arguments),l._removeTween(s)},e.onStop=function(){l._removeTween(s)},e.desc="tweenType:DisplayObject.animate__id:"+this.id+"__objectType:"+this.type,s=h.default.registTween(e),this._tweens.push(s),s}}},e.prototype._removeTween=function(t){for(var e=0;e<this._tweens.length;e++)if(t==this._tweens[e]){this._tweens.splice(e,1);break}},e.prototype.removeAnimate=function(t){t.stop(),this._removeTween(t)},e.prototype.cleanAnimates=function(){this._cleanAnimates()},e.prototype._cleanAnimates=function(){for(;this._tweens.length;)this._tweens.shift().stop()},e.prototype.remove=function(){this.parent&&(this.parent.removeChild(this),this.parent=null)},e.prototype.destroy=function(){this._destroy()},e.prototype._destroy=function(){this.remove(),this.fire("destroy"),this.context=null,delete this.context},e}(a.event.Dispatcher);e.default=d});