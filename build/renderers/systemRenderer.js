define("renderers/systemRenderer",["../const","../settings","../animation/AnimationFrame","../utils/index","mmvis"],function(e,t,a){"use strict";t.__esModule=!0;var n=e("../const"),i=e("../settings"),r=e("../animation/AnimationFrame"),s=e("../utils/index"),p=e("mmvis"),o=function(){function e(e,t,a){if(void 0===e&&(e=n.RENDERER_TYPE.UNKNOWN),this.type=e,this.app=t,a)for(var r in i.default.RENDER_OPTIONS)void 0===a[r]&&(a[r]=i.default.RENDER_OPTIONS[r]);else a=i.default.RENDER_OPTIONS;this.options=a,this.requestAid=null,this._heartBeat=!1,this._preRenderTime=0}return e.prototype.startEnter=function(){var e=this;e.requestAid||(e.requestAid=r.default.registFrame({id:"enterFrame",task:function(){e.enterFrame.apply(e)}}))},e.prototype.enterFrame=function(){this.requestAid=null,s.default.now=(new Date).getTime(),this._heartBeat&&(this.app.children.length&&this.render(this.app),this._heartBeat=!1,this._preRenderTime=(new Date).getTime())},e.prototype._convertCanvax=function(e){p._.each(this.app.children,function(t){t.context[e.name]=e.value})},e.prototype.heartBeat=function(e){var t=this;if(e){if("context"==e.convertType){var a=e.stage,n=e.shape;e.name,e.value,e.preValue;if("canvax"==n.type)t._convertCanvax(e);else if(t.app.convertStages[a.id]||(t.app.convertStages[a.id]={stage:a,convertShapes:{}}),n){if(t.app.convertStages[a.id].convertShapes[n.id])return;t.app.convertStages[a.id].convertShapes[n.id]={shape:n,convertType:e.convertType}}}if("children"==e.convertType){var i=e.target;((a=e.src.getStage())||"stage"==i.type)&&(a=a||i,t.app.convertStages[a.id]||(t.app.convertStages[a.id]={stage:a,convertShapes:{}}))}if(!e.convertType){a=e.stage;t.app.convertStages[a.id]||(t.app.convertStages[a.id]={stage:a,convertShapes:{}})}}else p._.each(t.app.children,function(e,a){t.app.convertStages[e.id]={stage:e,convertShapes:{}}});t._heartBeat?t._heartBeat=!0:(t._heartBeat=!0,t.startEnter())},e}();t.default=o});