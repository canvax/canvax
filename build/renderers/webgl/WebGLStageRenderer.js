define("renderers/webgl/WebGLStageRenderer",["./utils/RenderTarget","./WebGLState","pixi-gl-core","../../const","../../settings","../../graphics/webgl/GraphicsRenderer"],function(t,e,i){"use strict";e.__esModule=!0;var n=t("./utils/RenderTarget"),r=t("./WebGLState"),s=t("pixi-gl-core"),o=t("../../const"),a=t("../../settings"),h=t("../../graphics/webgl/GraphicsRenderer"),l=0,d=function(){function t(t,e,i){void 0===i&&(i={}),this.type=o.RENDERER_TYPE.WEBGL,this.width=e.width,this.height=e.height,this.canvas=t.canvas,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.canvas.addEventListener("webglcontextlost",this.handleContextLost,!1),this.canvas.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._backgroundColorRgba=[0,0,0,0],this._contextOptions={alpha:i.transparent,antialias:i.antialias,premultipliedAlpha:i.transparent&&"notMultiplied"!==i.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer},this.gl=i.context||s.default.createContext(this.canvas,this._contextOptions),this.CONTEXT_UID=l++,this.state=new r.default(this.gl),this._activeShader=null,this._activeVao=null,this._activeRenderTarget=null,this.drawModes=this.mapWebGLDrawModes(),this.webglGR=new h.default(this),this._initContext()}return t.prototype._initContext=function(){var t=this.gl;t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext(),this.state.resetToDefault(),this.rootRenderTarget=new n.default(t,this.width,this.height,a.default.RESOLUTION,!0),this.rootRenderTarget.clearColor=this._backgroundColorRgba,this.bindRenderTarget(this.rootRenderTarget),this.webglGR.onContextChange()},t.prototype.render=function(t,e){this.gl&&!this.gl.isContextLost()&&this.webglGR.render(t,e)},t.prototype.resize=function(t,e){this.rootRenderTarget.resize(t,e),this._activeRenderTarget===this.rootRenderTarget&&(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))},t.prototype.clear=function(t){this._activeRenderTarget.clear(t)},t.prototype.bindRenderTarget=function(t){return t!==this._activeRenderTarget&&(this._activeRenderTarget=t,t.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=t.projectionMatrix.toArray(!0))),this},t.prototype.bindShader=function(t){return this._activeShader!==t&&(this._activeShader=t,t.bind(),t.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0)),this},t.prototype.createVao=function(){return new s.default.VertexArrayObject(this.gl,this.state.attribState)},t.prototype.bindVao=function(t){return this._activeVao===t?this:(t?t.bind():this._activeVao&&this._activeVao.unbind(),this._activeVao=t,this)},t.prototype.reset=function(){return this._activeShader=null,this._activeRenderTarget=this.rootRenderTarget,this.rootRenderTarget.activate(),this.state.resetToDefault(),this},t.prototype.handleContextLost=function(t){t.preventDefault()},t.prototype.handleContextRestored=function(){this._initContext(),this.textureManager.removeAll()},t.prototype.mapWebGLDrawModes=function(t){return void 0===t&&(t={}),t[o.DRAW_MODES.POINTS]=this.gl.POINTS,t[o.DRAW_MODES.LINES]=this.gl.LINES,t[o.DRAW_MODES.LINE_LOOP]=this.gl.LINE_LOOP,t[o.DRAW_MODES.LINE_STRIP]=this.gl.LINE_STRIP,t[o.DRAW_MODES.TRIANGLES]=this.gl.TRIANGLES,t[o.DRAW_MODES.TRIANGLE_STRIP]=this.gl.TRIANGLE_STRIP,t[o.DRAW_MODES.TRIANGLE_FAN]=this.gl.TRIANGLE_FAN,t},t.prototype.destroy=function(t){this.destroyPlugins(),this.canvas.removeEventListener("webglcontextlost",this.handleContextLost),this.canvas.removeEventListener("webglcontextrestored",this.handleContextRestored),_super.prototype.destroy.call(this,t),this.uid=0,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.gl.useProgram(null),this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext(),this.gl=null},t}();e.default=d});