define("renderers/canvas/CanvasRenderer",["../SystemRenderer","../../const","../../graphics/canvas/GraphicsRenderer","mmvis"],function(r,e,t){"use strict";var a,n=this&&this.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])},function(r,e){function t(){this.constructor=r}a(r,e),r.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)});e.__esModule=!0;var o=r("../SystemRenderer"),s=r("../../const"),i=r("../../graphics/canvas/GraphicsRenderer"),c=r("mmvis"),p=function(r){function e(e,t){void 0===t&&(t={});var a=r.call(this,s.RENDERER_TYPE.CANVAS,e,t)||this;return a.CGR=new i.default(a),a}return n(e,r),e.prototype.render=function(r){var e=this;e.app=r,c._.each(c._.values(r.convertStages),function(r){e.renderStage(r.stage)}),r.convertStages={}},e.prototype.renderStage=function(r){r.ctx||(r.ctx=r.canvas.getContext("2d")),r.stageRending=!0,r.setWorldTransform(),this._clear(r),this._render(r,r,r.context.globalAlpha),r.stageRending=!1},e.prototype._render=function(r,e,t){var a=r.ctx;if(a){var n=e.context.$model;if((!e.worldTransform||e._transformChange||e.parent&&e.parent._transformChange)&&(e.setWorldTransform(),e._transformChange=!0),t*=n.globalAlpha,n.visible&&!e.isClip){a.setTransform.apply(a,e.worldTransform.toArray());var o=!1;if(e.clip&&e.clip.graphics){var s=e.clip;a.save(),o=!0,(!s.worldTransform||s._transformChange||s.parent._transformChange)&&(s.setWorldTransform(),s._transformChange=!0),a.setTransform.apply(a,s.worldTransform.toArray()),s.graphics.graphicsData.length||s._draw(s.graphics),this.CGR.render(s,r,t,o),s._transformChange=!1,a.clip()}if(e.graphics&&(e.graphics.graphicsData.length||e._draw(e.graphics),t&&this.CGR.render(e,r,t)),"text"==e.type&&e.render(a,t),e.children)for(var i=0,c=e.children.length;i<c;i++)this._render(r,e.children[i],t);e._transformChange=!1,o&&a.restore()}}},e.prototype._clear=function(r){var e=r.ctx;e.setTransform.apply(e,r.worldTransform.toArray()),e.clearRect(0,0,this.app.width,this.app.height)},e}(o.default);e.default=p});