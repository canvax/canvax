define("Application",["./utils/index","./display/DisplayObjectContainer","./display/Stage","./renderers/autoRenderer","./geom/Matrix","mmvis"],function(t,e,i){"use strict";var h,n=this&&this.__extends||(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});e.__esModule=!0;var s=t("./utils/index"),a=t("./display/DisplayObjectContainer"),r=t("./display/Stage"),o=t("./renderers/autoRenderer"),d=t("./geom/Matrix"),l=t("mmvis"),c=function(t){function e(e,i){void 0===i&&(i={});var h=this;e.type="canvax",(h=t.call(this,e)||this)._cid=(new Date).getTime()+"_"+Math.floor(100*Math.random()),h.el=l.$.query(e.el),h.width=parseInt("width"in e||h.el.offsetWidth,10),h.height=parseInt("height"in e||h.el.offsetHeight,10);var n=l.$.createView(h.width,h.height,h._cid);return h.view=n.view,h.stageView=n.stageView,h.domView=n.domView,h.el.innerHTML="",h.el.appendChild(h.view),h.viewOffset=l.$.offset(h.view),h.lastGetRO=0,h.webGL=e.webGL,h.renderer=o.default(h,i),h.event=null,h.preventDefault=!0,!1===e.preventDefault&&(h.preventDefault=!1),h.convertStages={},h.context.$model.width=h.width,h.context.$model.height=h.height,h._bufferStage=null,h._creatHoverStage(),h.worldTransform=(new d.default).identity(),h}return n(e,t),e.prototype.registEvent=function(t){return this.event=new l.event.Handler(this,t),this.event.init(),this.event},e.prototype.destroy=function(){for(var t=0,e=this.children.length;t<e;t++){var i=this.children[t];i.destroy(),i.canvas=null,i.ctx=null,i=null,t--,e--}this.view.removeChild(this.stageView),this.view.removeChild(this.domView),this.el.removeChild(this.view),this.el.innerHTML="",this.event=null,this._bufferStage=null},e.prototype.resize=function(t){this.width=parseInt(t&&"width"in t||this.el.offsetWidth,10),this.height=parseInt(t&&"height"in t||this.el.offsetHeight,10),this.viewOffset=l.$.offset(this.view),this.context.$model.width=this.width,this.context.$model.height=this.height;var e=this;l._.each(this.children,function(t,i){var h;t.context.$model.width=e.width,t.context.$model.height=e.height,(h=t.canvas).style.width=e.width+"px",h.style.height=e.height+"px",h.setAttribute("width",e.width*s.default._devicePixelRatio),h.setAttribute("height",e.height*s.default._devicePixelRatio)}),this.stageView.style.width=this.width+"px",this.stageView.style.height=this.height+"px",this.domView.style.width=this.width+"px",this.domView.style.height=this.height+"px",this.heartBeat()},e.prototype.getHoverStage=function(){return this._bufferStage},e.prototype._creatHoverStage=function(){this._bufferStage=new r.default({id:"activCanvas"+(new Date).getTime(),context:{width:this.context.$model.width,height:this.context.$model.height}}),this._bufferStage._eventEnabled=!1,this.addChild(this._bufferStage)},e.prototype.updateViewOffset=function(){var t=(new Date).getTime();t-this.lastGetRO>1e3&&(this.viewOffset=l.$.offset(this.view),this.lastGetRO=t)},e.prototype._afterAddChild=function(t,e){var i;i=t.canvas?t.canvas:l.$.createCanvas(this.context.$model.width,this.context.$model.height,t.id),1==this.children.length?this.stageView.appendChild(i):this.children.length>1&&(void 0===e?this.stageView.insertBefore(i,this._bufferStage.canvas):e>=this.children.length-1?this.stageView.appendChild(i):this.stageView.insertBefore(i,this.children[e].canvas)),s.default.initElement(i),t.initStage(i,this.context.$model.width,this.context.$model.height)},e.prototype._afterDelChild=function(t){this.stageView.removeChild(t.canvas)},e.prototype.heartBeat=function(t){this.children.length>0&&this.renderer.heartBeat(t)},e.prototype.toDataURL=function(){var t=l.$.createCanvas(this.width,this.height,"curr_base64_canvas"),e=t.getContext("2d");return l._.each(this.children,function(t){e.drawImage(t.canvas,0,0)}),t.toDataURL()},e}(a.default);e.default=c});