define("graphics/Graphics",["./GraphicsData","../math/index","../const","./utils/bezierCurveTo","mmvis"],function(t,h,i){"use strict";h.__esModule=!0;var e=t("./GraphicsData"),r=t("../math/index"),a=t("../const"),s=t("./utils/bezierCurveTo"),n=t("mmvis"),o=function(){function t(t){this.lineWidth=1,this.strokeStyle=null,this.lineAlpha=1,this.fillStyle=null,this.fillAlpha=1,this.graphicsData=[],this.currentPath=null,this.dirty=0,this.clearDirty=0,this._webGL={},this.worldAlpha=1,this.tint=16777215,this.Bound={x:0,y:0,width:0,height:0}}return t.prototype.setStyle=function(t){var h=t.$model;this.lineWidth=h.lineWidth,this.strokeStyle=h.strokeStyle,this.lineAlpha=h.lineAlpha*h.globalAlpha,this.fillStyle=h.fillStyle,this.fillAlpha=h.fillAlpha*h.globalAlpha;var i=this;this.graphicsData.length&&n._.each(this.graphicsData,function(t,h){t.synsStyle(i)})},t.prototype.clone=function(){var h=new t;h.dirty=0;for(var i=0;i<this.graphicsData.length;++i)h.graphicsData.push(this.graphicsData[i].clone());return h.currentPath=h.graphicsData[h.graphicsData.length-1],h},t.prototype.moveTo=function(t,h){var i=new r.Polygon([t,h]);return i.closed=!1,this.drawShape(i),this},t.prototype.lineTo=function(t,h){return this.currentPath?(this.currentPath.shape.points.push(t,h),this.dirty++):this.moveTo(0,0),this},t.prototype.quadraticCurveTo=function(t,h,i,e){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var r=this.currentPath.shape.points,a=0,s=0;0===r.length&&this.moveTo(0,0);for(var n=r[r.length-2],o=r[r.length-1],l=1;l<=20;++l){var p=l/20;a=n+(t-n)*p,s=o+(h-o)*p,r.push(a+(t+(i-t)*p-a)*p,s+(h+(e-h)*p-s)*p)}return this.dirty++,this},t.prototype.bezierCurveTo=function(t,h,i,e,r,a){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var n=this.currentPath.shape.points,o=n[n.length-2],l=n[n.length-1];return n.length-=2,s.default(o,l,t,h,i,e,r,a,n),this.dirty++,this},t.prototype.arcTo=function(t,h,i,e,r){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,h):this.moveTo(t,h);var a=this.currentPath.shape.points,s=a[a.length-2],n=a[a.length-1]-h,o=s-t,l=e-h,p=i-t,u=Math.abs(n*p-o*l);if(u<1e-8||0===r)a[a.length-2]===t&&a[a.length-1]===h||a.push(t,h);else{var c=n*n+o*o,g=l*l+p*p,d=n*l+o*p,y=r*Math.sqrt(c)/u,f=r*Math.sqrt(g)/u,P=y*d/c,v=f*d/g,w=y*p+f*o,S=y*l+f*n,D=o*(f+P),M=n*(f+P),A=p*(y+v),b=l*(y+v),m=Math.atan2(M-S,D-w),T=Math.atan2(b-S,A-w);this.arc(w+t,S+h,r,m,T,o*l>p*n)}return this.dirty++,this},t.prototype.arc=function(t,h,i,e,r,a){if(void 0===a&&(a=!1),e===r)return this;!a&&r<=e?r+=2*Math.PI:a&&e<=r&&(e+=2*Math.PI);var s=r-e,n=48*Math.ceil(Math.abs(s)/(2*Math.PI));if(0===s)return this;var o=t+Math.cos(e)*i,l=h+Math.sin(e)*i,p=this.currentPath?this.currentPath.shape.points:null;p?p[p.length-2]===o&&p[p.length-1]===l||p.push(o,l):(this.moveTo(o,l),p=this.currentPath.shape.points);for(var u=s/(2*n),c=2*u,g=Math.cos(u),d=Math.sin(u),y=n-1,f=y%1/y,P=0;P<=y;++P){var v=u+e+c*(P+f*P),w=Math.cos(v),S=-Math.sin(v);p.push((g*w+d*S)*i+t,(g*-S+d*w)*i+h)}return this.dirty++,this},t.prototype.drawRect=function(t,h,i,e){return this.drawShape(new r.Rectangle(t,h,i,e)),this},t.prototype.drawCircle=function(t,h,i){return this.drawShape(new r.Circle(t,h,i)),this},t.prototype.drawEllipse=function(t,h,i,e){return this.drawShape(new r.Ellipse(t,h,i,e)),this},t.prototype.drawPolygon=function(t){var h=t,i=!0;if(h instanceof r.Polygon&&(i=h.closed,h=h.points),!Array.isArray(h)){h=new Array(arguments.length);for(var e=0;e<h.length;++e)h[e]=arguments[e]}var a=new r.Polygon(h);return a.closed=i,this.drawShape(a),this},t.prototype.clear=function(){return this.graphicsData.length>0&&(this.dirty++,this.clearDirty++,this.graphicsData.length=0),this.currentPath=null,this},t.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.beginPath();var h=new e.default(this.lineWidth,this.strokeStyle,this.lineAlpha,this.fillStyle,this.fillAlpha,t);return this.graphicsData.push(h),h.type===a.SHAPES.POLY&&(h.shape.closed=h.shape.closed,this.currentPath=h),this.dirty++,h},t.prototype.beginPath=function(){this.currentPath=null},t.prototype.closePath=function(){var t=this.currentPath;return t&&t.shape&&t.shape.close(),this},t.prototype.updateLocalBounds=function(){var t=1/0,h=-1/0,i=1/0,e=-1/0;if(this.graphicsData.length)for(var r=0,s=0,n=0,o=0,l=0,p=0;p<this.graphicsData.length;p++){var u=this.graphicsData[p],c=u.type,g=u.lineWidth;if(r=u.shape,c===a.SHAPES.RECT||c===a.SHAPES.RREC)s=r.x-g/2,n=r.y-g/2,o=r.width+g,l=r.height+g,t=s<t?s:t,h=s+o>h?s+o:h,i=n<i?n:i,e=n+l>e?n+l:e;else if(c===a.SHAPES.CIRC)s=r.x,n=r.y,o=r.radius+g/2,l=r.radius+g/2,t=s-o<t?s-o:t,h=s+o>h?s+o:h,i=n-l<i?n-l:i,e=n+l>e?n+l:e;else if(c===a.SHAPES.ELIP)s=r.x,n=r.y,o=r.width+g/2,l=r.height+g/2,t=s-o<t?s-o:t,h=s+o>h?s+o:h,i=n-l<i?n-l:i,e=n+l>e?n+l:e;else for(var d=r.points,y=0,f=0,P=0,v=0,w=0,S=0,D=0,M=0,A=0;A+2<d.length;A+=2)s=d[A],n=d[A+1],y=d[A+2],f=d[A+3],P=Math.abs(y-s),v=Math.abs(f-n),l=g,(o=Math.sqrt(P*P+v*v))<1e-9||(S=(l/o*P+v)/2,M=(f+n)/2,t=(D=(y+s)/2)-(w=(l/o*v+P)/2)<t?D-w:t,h=D+w>h?D+w:h,i=M-S<i?M-S:i,e=M+S>e?M+S:e)}else t=0,h=0,i=0,e=0;return this.Bound={x:t,y:i,width:h-t,height:e-i},this},t.prototype.getBound=function(){return this.updateLocalBounds().Bound},t.prototype.destroy=function(t){for(var h=0;h<this.graphicsData.length;++h)this.graphicsData[h].destroy();for(var i in this._webGL)for(var e=0;e<this._webGL[i].data.length;++e)this._webGL[i].data[e].destroy();this.graphicsData=null,this.currentPath=null,this._webGL=null},t}();h.default=o});